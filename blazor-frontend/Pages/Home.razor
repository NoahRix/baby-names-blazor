@page "/"
@inject AppState AppState

<PageTitle>Baby Names Explorer</PageTitle>

<h1>Baby Names Explorer</h1>
<p>HOT RELOAD TEST - If you see this, it worked! Noah Rix is very cute</p>

<MudContainer MaxWidth="MaxWidth.ExtraExtraLarge" Class="d-flex flex-column align-center">
    <MudPaper Class="pa-4 ma-4" Elevation="0" Style="width: 100%;">
        <h2>US Map Component Below:</h2>
        <USMap />
        
        @if (AppState.SelectedState != null)
        {
            <div class="d-flex flex-column align-center mt-4">
                <MudText Typo="Typo.h6">Select a year</MudText>
                <MudText>@AppState.SelectedYear</MudText>
                <NumericalSlider />
            </div>
        }
    </MudPaper>

    <YearGenderCountChart />

    @if (AppState.CommitedYear != null && AppState.TopPopularMaleFemaleNameCounts != null)
    {
        <MudGrid Spacing="6" Justify="Justify.Center" Style="width: 90%; max-width: 100%; margin-top: 2rem;">
            <MudItem xs="12" md="6" Class="d-flex flex-column align-center">
                <MudText Typo="Typo.h6">
                    Distinct Male Name Count: @AppState.DistinctMaleCountForSelectedState?.ToString("N0")
                </MudText>
                <PieChartWithCenterLabel 
                    Title="@($"Top 5 Male Names for {AppState.SelectedState?.StateName}")"
                    Data="@AppState.TopPopularMaleFemaleNameCounts.Male" />
            </MudItem>
            <MudItem xs="12" md="6" Class="d-flex flex-column align-center">
                <MudText Typo="Typo.h6">
                    Distinct Female Name Count: @AppState.DistinctFemaleCountForSelectedState?.ToString("N0")
                </MudText>
                <PieChartWithCenterLabel 
                    Title="@($"Top 5 Female Names for {AppState.SelectedState?.StateName}")"
                    Data="@AppState.TopPopularMaleFemaleNameCounts.Female" />
            </MudItem>
        </MudGrid>
    }
</MudContainer>

@code {
    protected override void OnInitialized()
    {
        AppState.OnChange += OnStateChanged;
    }

    private async void OnStateChanged()
    {
        await InvokeAsync(() =>
        {
            Console.WriteLine($"Home.OnStateChanged fired - CommitedYear: {AppState.CommitedYear}, SelectedState: {AppState.SelectedState?.StateName}");
            // Just trigger a re-render - all data is already in AppState from USMap
            StateHasChanged();
            return Task.CompletedTask;
        });
    }

    public void Dispose()
    {
        AppState.OnChange -= OnStateChanged;
    }
}
